{"paragraphs":[{"text":"/*\r\n\tThis code is intended to be run in the Scala shell. \r\n\tLaunch the Scala Spark shell by running ./bin/spark-shell from the Spark directory.\r\n\tYou can enter each line in the shell and see the result immediately.\r\n\tThe expected output in the Spark console is presented as commented lines following the\r\n\trelevant code\r\n\r\n\tThe Scala shell creates a SparkContex variable available to us as 'sc'\r\n\r\n  Ensure you start the shell with sufficient memory: ./bin/spark-shell --driver-memory 4g\r\n*/\r\n\r\n/* Load the raw ratings data from a file. Replace 'PATH' with the path to the MovieLens data */\r\nval path = \"D:\\\\Project\\\\Spark\\\\Machine-Learning-with-Spark\\\\Data\"\r\nval rawData = sc.textFile(path + \"\\\\ml-100k\\\\u.data\")\r\n","dateUpdated":"2016-11-22T11:13:48+0900","config":{"colWidth":12,"editorMode":"ace/mode/scala","graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1479777313143_-1327597267","id":"20161121-104829_919099671","result":{"code":"SUCCESS","type":"TEXT","msg":"\r\n\npath: String = D:\\Project\\Spark\\Machine-Learning-with-Spark\\Data\r\nrawData: org.apache.spark.rdd.RDD[String] = D:\\Project\\Spark\\Machine-Learning-with-Spark\\Data\\ml-100k\\u.data MapPartitionsRDD[5] at textFile at <console>:43\n"},"dateCreated":"2016-11-22T10:15:13+0900","dateStarted":"2016-11-22T11:13:48+0900","dateFinished":"2016-11-22T11:13:48+0900","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2694","focus":true},{"text":"rawData.first()","dateUpdated":"2016-11-22T11:13:52+0900","config":{"colWidth":12,"editorMode":"ace/mode/scala","graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1479777313145_-1329905761","id":"20161121-105716_1463941806","result":{"code":"SUCCESS","type":"TEXT","msg":"\nres5: String = 196\t242\t3\t881250949\n"},"dateCreated":"2016-11-22T10:15:13+0900","dateStarted":"2016-11-22T11:13:52+0900","dateFinished":"2016-11-22T11:13:52+0900","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2695","focus":true},{"text":"/* Extract the user id, movie id and rating only from the dataset */\r\nval rawRatings = rawData.map(_.split(\"\\t\").take(3))\r\nrawRatings.first()","dateUpdated":"2016-11-22T10:16:31+0900","config":{"colWidth":12,"editorMode":"ace/mode/scala","graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1479777313145_-1329905761","id":"20161121-104844_323629137","result":{"code":"SUCCESS","type":"TEXT","msg":"\nrawRatings: org.apache.spark.rdd.RDD[Array[String]] = MapPartitionsRDD[2] at map at <console>:30\n\nres4: Array[String] = Array(196, 242, 3)\n"},"dateCreated":"2016-11-22T10:15:13+0900","dateStarted":"2016-11-22T10:16:31+0900","dateFinished":"2016-11-22T10:16:32+0900","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2696"},{"text":"/* Import Spark's ALS recommendation model and inspect the train method */\r\nimport org.apache.spark.mllib.recommendation.ALS\r\n//ALS.train","dateUpdated":"2016-11-22T10:16:37+0900","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1479777313145_-1329905761","id":"20161121-105021_745191795","result":{"code":"SUCCESS","type":"TEXT","msg":"\nimport org.apache.spark.mllib.recommendation.ALS\n"},"dateCreated":"2016-11-22T10:15:13+0900","dateStarted":"2016-11-22T10:16:37+0900","dateFinished":"2016-11-22T10:16:37+0900","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2697"},{"text":"/* Import the Rating class and inspect it */\r\nimport org.apache.spark.mllib.recommendation.Rating\r\n//Rating()","dateUpdated":"2016-11-22T10:16:46+0900","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1479777313145_-1329905761","id":"20161121-105029_894548082","result":{"code":"SUCCESS","type":"TEXT","msg":"\nimport org.apache.spark.mllib.recommendation.Rating\n"},"dateCreated":"2016-11-22T10:15:13+0900","dateStarted":"2016-11-22T10:16:46+0900","dateFinished":"2016-11-22T10:16:47+0900","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2698"},{"text":"/* Construct the RDD of Rating objects */\r\nval ratings = rawRatings.map { case Array(user, movie, rating) => Rating(user.toInt, movie.toInt, rating.toDouble) }\r\n","dateUpdated":"2016-11-22T10:16:48+0900","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1479777313146_-1328751514","id":"20161121-105036_1901053080","result":{"code":"SUCCESS","type":"TEXT","msg":"\nratings: org.apache.spark.rdd.RDD[org.apache.spark.mllib.recommendation.Rating] = MapPartitionsRDD[3] at map at <console>:35\n"},"dateCreated":"2016-11-22T10:15:13+0900","dateStarted":"2016-11-22T10:16:49+0900","dateFinished":"2016-11-22T10:16:49+0900","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2699"},{"text":"ratings.first()","dateUpdated":"2016-11-22T10:16:52+0900","config":{"colWidth":12,"editorMode":"ace/mode/scala","graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1479777313146_-1328751514","id":"20161121-110012_1485395541","result":{"code":"SUCCESS","type":"TEXT","msg":"\nres14: org.apache.spark.mllib.recommendation.Rating = Rating(196,242,3.0)\n"},"dateCreated":"2016-11-22T10:15:13+0900","dateStarted":"2016-11-22T10:16:52+0900","dateFinished":"2016-11-22T10:16:52+0900","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2700"},{"text":"/* Train the ALS model with rank=50, iterations=10, lambda=0.01 */\r\nval model = ALS.train(ratings, 50, 10, 0.01)","dateUpdated":"2016-11-22T10:16:54+0900","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1479777313146_-1328751514","id":"20161121-105053_667213749","result":{"code":"SUCCESS","type":"TEXT","msg":"\nmodel: org.apache.spark.mllib.recommendation.MatrixFactorizationModel = org.apache.spark.mllib.recommendation.MatrixFactorizationModel@6bec0635\n"},"dateCreated":"2016-11-22T10:15:13+0900","dateStarted":"2016-11-22T10:16:55+0900","dateFinished":"2016-11-22T10:16:59+0900","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2701"},{"text":"/* Inspect the user factors */\r\nmodel.userFeatures","dateUpdated":"2016-11-22T10:17:02+0900","config":{"colWidth":12,"editorMode":"ace/mode/scala","graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1479777313146_-1328751514","id":"20161121-113124_375266397","result":{"code":"SUCCESS","type":"TEXT","msg":"\nres19: org.apache.spark.rdd.RDD[(Int, Array[Double])] = users MapPartitionsRDD[209] at mapValues at ALS.scala:268\n"},"dateCreated":"2016-11-22T10:15:13+0900","dateStarted":"2016-11-22T10:17:02+0900","dateFinished":"2016-11-22T10:17:03+0900","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2702"},{"text":"/* Count user factors and force computation */\r\nmodel.userFeatures.count","dateUpdated":"2016-11-22T10:17:07+0900","config":{"colWidth":12,"editorMode":"ace/mode/scala","graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1479777313146_-1328751514","id":"20161121-105056_447237152","result":{"code":"SUCCESS","type":"TEXT","msg":"\nres22: Long = 943\n"},"dateCreated":"2016-11-22T10:15:13+0900","dateStarted":"2016-11-22T10:17:07+0900","dateFinished":"2016-11-22T10:17:07+0900","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2703"},{"text":"model.productFeatures.count","dateUpdated":"2016-11-22T10:15:13+0900","config":{"colWidth":12,"editorMode":"ace/mode/scala","graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1479777313146_-1328751514","id":"20161121-105121_1777043564","result":{"code":"SUCCESS","type":"TEXT","msg":"\nres26: Long = 1682\n"},"dateCreated":"2016-11-22T10:15:13+0900","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:2704"},{"text":"model.productFeatures.take(5)","dateUpdated":"2016-11-22T10:15:13+0900","config":{"colWidth":12,"editorMode":"ace/mode/scala","graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1479777313147_-1329136263","id":"20161121-113326_634331923","result":{"code":"SUCCESS","type":"TEXT","msg":"res28: Array[(Int, Array[Double])] = Array((4,Array(0.08657698333263397, 0.1257057785987854, -0.25015637278556824, 0.15577693283557892, -1.1095222234725952, 0.6459395289421082, -0.4586084485054016, -0.8668961524963379, 0.4653545320034027, -1.6470407247543335, -0.04716486483812332, -0.8755130767822266, 0.6426496505737305, -0.13679443299770355, 0.3814478814601898, -0.7759294509887695, -0.6722021102905273, -0.15619370341300964, -0.44516313076019287, -0.8707677125930786, 0.06393597275018692, -0.22201433777809143, 0.9666264057159424, -0.020862489938735962, 1.333086609840393, 1.3668879270553589, 0.3099747598171234, -0.8586693406105042, -1.1509177684783936, 0.00502981711179018, 0.08306240290403366, -0.5014787912368774, 0.05253753438591957, -0.4503585398197174, 1.0859674215316772, -0.0431031808..."},"dateCreated":"2016-11-22T10:15:13+0900","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:2705"},{"text":"/* Make a prediction for a single user and movie pair */ \r\nval predictedRating = model.predict(789, 123)","dateUpdated":"2016-11-22T10:15:13+0900","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1479777313147_-1329136263","id":"20161121-105138_1115583255","result":{"code":"SUCCESS","type":"TEXT","msg":"\npredictedRating: Double = 4.325293190060547\n"},"dateCreated":"2016-11-22T10:15:13+0900","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:2706"},{"text":"/* Make predictions for a single user across all movies */\r\nval userId = 789\r\nval K = 10\r\nval topKRecs = model.recommendProducts(userId, K)\r\nprintln(topKRecs.mkString(\"\\n\"))","dateUpdated":"2016-11-22T10:15:13+0900","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1479777313147_-1329136263","id":"20161121-105148_732966494","result":{"code":"SUCCESS","type":"TEXT","msg":"\nuserId: Int = 789\n\nK: Int = 10\n\ntopKRecs: Array[org.apache.spark.mllib.recommendation.Rating] = Array(Rating(789,469,5.88302670361179), Rating(789,32,5.737206244930951), Rating(789,646,5.513649522607573), Rating(789,182,5.4302608500047524), Rating(789,178,5.250931483549825), Rating(789,177,5.175986604590209), Rating(789,1019,5.162495185001511), Rating(789,134,5.113250623808765), Rating(789,1098,5.098727573430531), Rating(789,42,5.089860688702365))\nRating(789,469,5.88302670361179)\nRating(789,32,5.737206244930951)\nRating(789,646,5.513649522607573)\nRating(789,182,5.4302608500047524)\nRating(789,178,5.250931483549825)\nRating(789,177,5.175986604590209)\nRating(789,1019,5.162495185001511)\nRating(789,134,5.113250623808765)\nRating(789,1098,5.098727573430531)\nRating(789,42,5.089860688702365)\r\n"},"dateCreated":"2016-11-22T10:15:13+0900","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:2707"},{"text":"/* Load movie titles to inspect the recommendations */\r\nval movies = sc.textFile(path + \"\\\\ml-100k\\\\u.item\")\r\nval titles = movies.map(line => line.split(\"\\\\|\").take(2)).map(array => (array(0).toInt, array(1))).collectAsMap()\r\ntitles(123)","dateUpdated":"2016-11-22T11:13:34+0900","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1479777313147_-1329136263","id":"20161121-105153_1230629238","result":{"code":"SUCCESS","type":"TEXT","msg":"\nmovies: org.apache.spark.rdd.RDD[String] = D:\\Project\\Spark\\8519OS_Code\\Chapter 03\\ml-100k\\u.item MapPartitionsRDD[214] at textFile at <console>:31\ntitles: scala.collection.Map[Int,String] = Map(137 -> Big Night (1996), 891 -> Bent (1997), 550 -> Die Hard: With a Vengeance (1995), 1205 -> Secret Agent, The (1996), 146 -> Unhook the Stars (1996), 864 -> My Fellow Americans (1996), 559 -> Interview with the Vampire (1994), 218 -> Cape Fear (1991), 568 -> Speed (1994), 227 -> Star Trek VI: The Undiscovered Country (1991), 765 -> Boomerang (1992), 1115 -> Twelfth Night (1996), 774 -> Prophecy, The (1995), 433 -> Heathers (1989), 92 -> True Romance (1993), 1528 -> Nowhere (1997), 846 -> To Gillian on Her 37th Birthday (1996), 1187 -> Switchblade Sisters (1975), 1501 -> Prisoner of the Mountains (Kavkazsky Plennik) (1996), 442 -> Amityville Curse, The (1990), 1160 -> Love! Valour! Compassion! (1997), 101 -> Heavy Metal (1981), 1196 -> Sa...\nres36: String = Frighteners, The (1996)\n"},"dateCreated":"2016-11-22T10:15:13+0900","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:2708"},{"text":"val moviesForUser = ratings.keyBy(_.user).lookup(789)\nprintln(moviesForUser.size)","dateUpdated":"2016-11-22T10:15:13+0900","config":{"colWidth":12,"editorMode":"ace/mode/scala","graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1479777313147_-1329136263","id":"20161121-105204_1207564081","result":{"code":"SUCCESS","type":"TEXT","msg":"\nmoviesForUser: Seq[org.apache.spark.mllib.recommendation.Rating] = WrappedArray(Rating(789,1012,4.0), Rating(789,127,5.0), Rating(789,475,5.0), Rating(789,93,4.0), Rating(789,1161,3.0), Rating(789,286,1.0), Rating(789,293,4.0), Rating(789,9,5.0), Rating(789,50,5.0), Rating(789,294,3.0), Rating(789,181,4.0), Rating(789,1,3.0), Rating(789,1008,4.0), Rating(789,508,4.0), Rating(789,284,3.0), Rating(789,1017,3.0), Rating(789,137,2.0), Rating(789,111,3.0), Rating(789,742,3.0), Rating(789,248,3.0), Rating(789,249,3.0), Rating(789,1007,4.0), Rating(789,591,3.0), Rating(789,150,5.0), Rating(789,276,5.0), Rating(789,151,2.0), Rating(789,129,5.0), Rating(789,100,5.0), Rating(789,741,5.0), Rating(789,288,3.0), Rating(789,762,3.0), Rating(789,628,3.0), Rating(789,124,4.0))\n33\r\n"},"dateCreated":"2016-11-22T10:15:13+0900","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:2709"},{"text":"\nmoviesForUser.sortBy(-_.rating).take(10).map(rating => (titles(rating.product), rating.rating)).foreach(println)","dateUpdated":"2016-11-22T10:15:13+0900","config":{"colWidth":11,"graph":{"mode":"table","height":86.53408813476562,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1479777313147_-1329136263","id":"20161121-105218_1207749469","result":{"code":"SUCCESS","type":"TEXT","msg":"(Godfather, The (1972),5.0)\r\n(Trainspotting (1996),5.0)\r\n(Dead Man Walking (1995),5.0)\r\n(Star Wars (1977),5.0)\r\n(Swingers (1996),5.0)\r\n(Leaving Las Vegas (1995),5.0)\r\n(Bound (1996),5.0)\r\n(Fargo (1996),5.0)\r\n(Last Supper, The (1995),5.0)\r\n(Private Parts (1997),4.0)\r\n"},"dateCreated":"2016-11-22T10:15:13+0900","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:2710"},{"text":"topKRecs.map(rating => (titles(rating.product), rating.rating)).foreach(println)","dateUpdated":"2016-11-22T10:15:13+0900","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1479777313147_-1329136263","id":"20161121-105234_1124696383","result":{"code":"SUCCESS","type":"TEXT","msg":"(Short Cuts (1993),5.88302670361179)\r\n(Crumb (1994),5.737206244930951)\r\n(Once Upon a Time in the West (1969),5.513649522607573)\r\n(GoodFellas (1990),5.4302608500047524)\r\n(12 Angry Men (1957),5.250931483549825)\r\n(Good, The Bad and The Ugly, The (1966),5.175986604590209)\r\n(Die xue shuang xiong (Killer, The) (1989),5.162495185001511)\r\n(Citizen Kane (1941),5.113250623808765)\r\n(Flirting With Disaster (1996),5.098727573430531)\r\n(Clerks (1994),5.089860688702365)\r\n"},"dateCreated":"2016-11-22T10:15:13+0900","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:2711"},{"text":"/* Compute item-to-item similarities between an item and the other items */\r\nimport org.jblas.DoubleMatrix\r\nval aMatrix = new DoubleMatrix(Array(1.0, 2.0, 3.0))","dateUpdated":"2016-11-22T10:15:13+0900","config":{"colWidth":12,"editorMode":"ace/mode/scala","graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1479777313148_-1331060007","id":"20161121-105241_798051349","result":{"code":"SUCCESS","type":"TEXT","msg":"\nimport org.jblas.DoubleMatrix\n\naMatrix: org.jblas.DoubleMatrix = [1.000000; 2.000000; 3.000000]\n"},"dateCreated":"2016-11-22T10:15:13+0900","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:2712"},{"text":"/* Compute the cosine similarity between two vectors */\r\ndef cosineSimilarity(vec1: DoubleMatrix, vec2: DoubleMatrix): Double = {\r\n\tvec1.dot(vec2) / (vec1.norm2() * vec2.norm2())\r\n}","dateUpdated":"2016-11-22T10:15:13+0900","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1479777313148_-1331060007","id":"20161121-105251_893602738","result":{"code":"SUCCESS","type":"TEXT","msg":"\ncosineSimilarity: (vec1: org.jblas.DoubleMatrix, vec2: org.jblas.DoubleMatrix)Double\n"},"dateCreated":"2016-11-22T10:15:13+0900","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:2713"},{"text":"val itemId = 567\r\nval itemFactor = model.productFeatures.lookup(itemId).head","dateUpdated":"2016-11-22T10:15:13+0900","config":{"colWidth":12,"editorMode":"ace/mode/scala","graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1479777313148_-1331060007","id":"20161121-105301_304885976","result":{"code":"SUCCESS","type":"TEXT","msg":"\nitemId: Int = 567\nitemFactor: Array[Double] = Array(-0.2428084760904312, 1.1899079084396362, -0.5089432597160339, -0.11575070023536682, -0.4538271725177765, 0.576653003692627, -0.08629702031612396, 0.13822095096111298, -0.52397620677948, -1.7313551902770996, -0.09901896119117737, 0.42019179463386536, -0.22345177829265594, -0.6696839332580566, -0.3141949772834778, -0.46663251519203186, -0.2429611086845398, -0.9718653559684753, -0.4039102792739868, -0.7641394734382629, -0.1274576336145401, -0.004319421947002411, 0.5206310153007507, -0.6927159428596497, 0.9819598197937012, 0.3738142251968384, 0.3774380087852478, -0.6378039121627808, 0.27082616090774536, -0.43427717685699463, 0.05687626823782921, -0.3499954342842102, 0.953403651714325, -0.40612125396728516, 0.6911481618881226, -0.6960133910179138, -0.5147696..."},"dateCreated":"2016-11-22T10:15:13+0900","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:2714"},{"text":"val itemVector = new DoubleMatrix(itemFactor)\ncosineSimilarity(itemVector, itemVector)","dateUpdated":"2016-11-22T10:15:13+0900","config":{"colWidth":12,"editorMode":"ace/mode/scala","graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1479777313148_-1331060007","id":"20161121-105318_1117719024","result":{"code":"SUCCESS","type":"TEXT","msg":"\nitemVector: org.jblas.DoubleMatrix = [-0.242808; 1.189908; -0.508943; -0.115751; -0.453827; 0.576653; -0.086297; 0.138221; -0.523976; -1.731355; -0.099019; 0.420192; -0.223452; -0.669684; -0.314195; -0.466633; -0.242961; -0.971865; -0.403910; -0.764139; -0.127458; -0.004319; 0.520631; -0.692716; 0.981960; 0.373814; 0.377438; -0.637804; 0.270826; -0.434277; 0.056876; -0.349995; 0.953404; -0.406121; 0.691148; -0.696013; -0.514770; 0.502032; -0.225793; 0.799944; -0.361528; -0.938381; -0.233301; -0.550187; 0.337422; 0.067566; -1.198438; -0.045935; -0.280561; -0.448226]\n\nres50: Double = 1.0000000000000002\n"},"dateCreated":"2016-11-22T10:15:13+0900","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:2715"},{"text":"val sims = model.productFeatures.map{ case (id, factor) => \r\n\tval factorVector = new DoubleMatrix(factor)\r\n\tval sim = cosineSimilarity(factorVector, itemVector)\r\n\t(id, sim)\r\n}\r\nval sortedSims = sims.top(K)(Ordering.by[(Int, Double), Double] { case (id, similarity) => similarity })\r\nprintln(sortedSims.mkString(\"\\n\"))","dateUpdated":"2016-11-22T10:15:13+0900","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1479777313148_-1331060007","id":"20161121-105339_1797029781","result":{"code":"SUCCESS","type":"TEXT","msg":"\nsims: org.apache.spark.rdd.RDD[(Int, Double)] = MapPartitionsRDD[220] at map at <console>:47\n\nsortedSims: Array[(Int, Double)] = Array((567,1.0000000000000002), (895,0.7019286200526045), (219,0.70155742823111), (288,0.6993303236126662), (1016,0.6935427993922932), (403,0.6887844259745696), (201,0.6863622457481389), (670,0.6847359362422114), (184,0.6827421672634448), (413,0.6772209522657197))\n(567,1.0000000000000002)\n(895,0.7019286200526045)\n(219,0.70155742823111)\n(288,0.6993303236126662)\n(1016,0.6935427993922932)\n(403,0.6887844259745696)\n(201,0.6863622457481389)\n(670,0.6847359362422114)\n(184,0.6827421672634448)\n(413,0.6772209522657197)\r\n"},"dateCreated":"2016-11-22T10:15:13+0900","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:2716"},{"text":"/* We can check the movie title of our chosen movie and the most similar movies to it */\r\nprintln(titles(itemId))\r\n// Wes Craven's New Nightmare (1994)\r\nval sortedSims2 = sims.top(K + 1)(Ordering.by[(Int, Double), Double] { case (id, similarity) => similarity })\r\nsortedSims2.slice(1, 11).map{ case (id, sim) => (titles(id), sim) }.mkString(\"\\n\")","dateUpdated":"2016-11-22T10:15:13+0900","config":{"colWidth":12,"editorMode":"ace/mode/scala","graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1479777313148_-1331060007","id":"20161121-105349_1354684984","result":{"code":"SUCCESS","type":"TEXT","msg":"Wes Craven's New Nightmare (1994)\r\n\nsortedSims2: Array[(Int, Double)] = Array((567,1.0000000000000002), (895,0.7019286200526045), (219,0.70155742823111), (288,0.6993303236126662), (1016,0.6935427993922932), (403,0.6887844259745696), (201,0.6863622457481389), (670,0.6847359362422114), (184,0.6827421672634448), (413,0.6772209522657197), (129,0.6758791831966473))\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\nres56: String =\r\n(Scream 2 (1997),0.7019286200526045)\r\n(Nightmare on Elm Street, A (1984),0.70155742823111)\r\n(Scream (1996),0.6993303236126662)\r\n(Con Air (1997),0.6935427993922932)\r\n(Batman (1989),0.6887844259745696)\r\n(Evil Dead II (1987),0.6863622457481389)\r\n(Body Snatchers (1993),0.6847359362422114)\r\n(Army of Darkness (1993),0.6827421672634448)\r\n(Tales from the Crypt Presents: Bordello of Blood (1996),0.6772209522657197)\r\n(Bound (1996),0.6758791831966473)\n"},"dateCreated":"2016-11-22T10:15:13+0900","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:2717"},{"text":"// We'll take the first rating for our example user 789\r\nval actualRating = moviesForUser.take(1)(0)\r\n// actualRating: Seq[org.apache.spark.mllib.recommendation.Rating] = WrappedArray(Rating(789,1012,4.0))\r\nval predictedRating = model.predict(789, actualRating.product)\r\n// ...\r\n// 14/04/13 13:01:15 INFO SparkContext: Job finished: lookup at MatrixFactorizationModel.scala:46, took 0.025404 s\r\n// predictedRating: Double = 4.001005374200248\r\nval squaredError = math.pow(predictedRating - actualRating.rating, 2.0)\r\n// squaredError: Double = 1.010777282523947E-6\r\n\r\n/* Compute Mean Squared Error across the dataset */\r\n// Below code is taken from the Apache Spark MLlib guide at: http://spark.apache.org/docs/latest/mllib-guide.html#collaborative-filtering-1\r\nval usersProducts = ratings.map{ case Rating(user, product, rating)  => (user, product)}\r\nval predictions = model.predict(usersProducts).map{\r\n    case Rating(user, product, rating) => ((user, product), rating)\r\n}\r\nval ratingsAndPredictions = ratings.map{\r\n    case Rating(user, product, rating) => ((user, product), rating)\r\n}.join(predictions)\r\nval MSE = ratingsAndPredictions.map{\r\n    case ((user, product), (actual, predicted)) =>  math.pow((actual - predicted), 2)\r\n}.reduce(_ + _) / ratingsAndPredictions.count\r\nprintln(\"Mean Squared Error = \" + MSE)","dateUpdated":"2016-11-22T10:15:13+0900","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1479777313148_-1331060007","id":"20161121-105416_392183887","result":{"code":"SUCCESS","type":"TEXT","msg":"\nactualRating: org.apache.spark.mllib.recommendation.Rating = Rating(789,1012,4.0)\n\npredictedRating: Double = 3.956506802512921\nMean Squared Error = 0.0843760594555458\r\n\r\n\r\n\r\n\r\n\nsquaredError: Double = 0.0018916582276500477\r\nusersProducts: org.apache.spark.rdd.RDD[(Int, Int)] = MapPartitionsRDD[223] at map at <console>:50\r\npredictions: org.apache.spark.rdd.RDD[((Int, Int), Double)] = MapPartitionsRDD[232] at map at <console>:51\r\nratingsAndPredictions: org.apache.spark.rdd.RDD[((Int, Int), (Double, Double))] = MapPartitionsRDD[236] at join at <console>:56\r\nMSE: Double = 0.0843760594555458\n"},"dateCreated":"2016-11-22T10:15:13+0900","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:2718"},{"text":"// Mean Squared Error = 0.08231947642632856\r\nval RMSE = math.sqrt(MSE)\r\nprintln(\"Root Mean Squared Error = \" + RMSE)","dateUpdated":"2016-11-22T10:15:13+0900","config":{"colWidth":12,"editorMode":"ace/mode/scala","graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1479777313148_-1331060007","id":"20161121-105421_1735502434","result":{"code":"SUCCESS","type":"TEXT","msg":"\nRMSE: Double = 0.290475574628136\nRoot Mean Squared Error = 0.290475574628136\r\n"},"dateCreated":"2016-11-22T10:15:13+0900","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:2719"},{"text":"/* Compute Mean Average Precision at K */\r\n\r\n/* Function to compute average precision given a set of actual and predicted ratings */\r\n// Code for this function is based on: https://github.com/benhamner/Metrics\r\ndef avgPrecisionK(actual: Seq[Int], predicted: Seq[Int], k: Int): Double = {\r\n  val predK = predicted.take(k)\r\n  var score = 0.0\r\n  var numHits = 0.0\r\n  for ((p, i) <- predK.zipWithIndex) {\r\n    if (actual.contains(p)) {\r\n      numHits += 1.0\r\n      score += numHits / (i.toDouble + 1.0)\r\n    }\r\n  }\r\n  if (actual.isEmpty) {\r\n    1.0\r\n  } else {\r\n    score / scala.math.min(actual.size, k).toDouble\r\n  }\r\n}\r\nval actualMovies = moviesForUser.map(_.product)\r\n// actualMovies: Seq[Int] = ArrayBuffer(1012, 127, 475, 93, 1161, 286, 293, 9, 50, 294, 181, 1, 1008, 508, 284, 1017, 137, 111, 742, 248, 249, 1007, 591, 150, 276, 151, 129, 100, 741, 288, 762, 628, 124)\r\nval predictedMovies = topKRecs.map(_.product)\r\n// predictedMovies: Array[Int] = Array(27, 497, 633, 827, 602, 849, 401, 584, 1035, 1014)\r\nval apk10 = avgPrecisionK(actualMovies, predictedMovies, 10)\r\n// apk10: Double = 0.0","dateUpdated":"2016-11-22T10:15:13+0900","config":{"colWidth":12,"editorMode":"ace/mode/scala","graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1479777313149_-1331444756","id":"20161121-105434_882292968","result":{"code":"SUCCESS","type":"TEXT","msg":"\r\n\r\n\r\n\navgPrecisionK: (actual: Seq[Int], predicted: Seq[Int], k: Int)Double\r\nactualMovies: Seq[Int] = ArrayBuffer(1012, 127, 475, 93, 1161, 286, 293, 9, 50, 294, 181, 1, 1008, 508, 284, 1017, 137, 111, 742, 248, 249, 1007, 591, 150, 276, 151, 129, 100, 741, 288, 762, 628, 124)\r\npredictedMovies: Array[Int] = Array(469, 32, 646, 182, 178, 177, 1019, 134, 1098, 42)\r\napk10: Double = 0.0\n"},"dateCreated":"2016-11-22T10:15:13+0900","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:2720"},{"text":"/* Compute recommendations for all users */\r\nval itemFactors = model.productFeatures.map { case (id, factor) => factor }.collect()\r\nval itemMatrix = new DoubleMatrix(itemFactors)\r\nprintln(itemMatrix.rows, itemMatrix.columns)","dateUpdated":"2016-11-22T10:15:13+0900","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1479777313149_-1331444756","id":"20161121-105455_1834849941","result":{"code":"SUCCESS","type":"TEXT","msg":"itemFactors: Array[Array[Double]] = Array(Array(0.08657698333263397, 0.1257057785987854, -0.25015637278556824, 0.15577693283557892, -1.1095222234725952, 0.6459395289421082, -0.4586084485054016, -0.8668961524963379, 0.4653545320034027, -1.6470407247543335, -0.04716486483812332, -0.8755130767822266, 0.6426496505737305, -0.13679443299770355, 0.3814478814601898, -0.7759294509887695, -0.6722021102905273, -0.15619370341300964, -0.44516313076019287, -0.8707677125930786, 0.06393597275018692, -0.22201433777809143, 0.9666264057159424, -0.020862489938735962, 1.333086609840393, 1.3668879270553589, 0.3099747598171234, -0.8586693406105042, -1.1509177684783936, 0.00502981711179018, 0.08306240290403366, -0.5014787912368774, 0.05253753438591957, -0.4503585398197174, 1.0859674215316772, -0.04310318082571...itemMatrix: org.jblas.DoubleMatrix = [0.086577, 0.125706, -0.250156, 0.155777, -1.109522, 0.645940, -0.458608, -0.866896, 0.465355, -1.647041, -0.047165, -0.875513, 0.642650, -0.136794, 0.381448, -0.775929, -0.672202, -0.156194, -0.445163, -0.870768, 0.063936, -0.222014, 0.966626, -0.020862, 1.333087, 1.366888, 0.309975, -0.858669, -1.150918, 0.005030, 0.083062, -0.501479, 0.052538, -0.450359, 1.085967, -0.043103, -0.347928, 0.774734, 0.759413, 0.487466, -0.432987, -1.656749, -0.173137, -1.043886, 0.237251, -0.047275, -1.319325, -0.703573, -0.220831, -0.842154; -0.167912, 0.016452, -0.888402, 0.928691, -1.216339, 0.609894, -0.372009, -1.061304, -0.326350, -1.488260, -0.136018, 0.052790, 0.720442, 0.376014, 0.231260, -0.586024, -0.483016, -0.079587, 0.388722, -0.770453, 0.229139, -1.0242...(1682,50)\r\n"},"dateCreated":"2016-11-22T10:15:13+0900","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:2721"},{"text":"// broadcast the item factor matrix\r\nval imBroadcast = sc.broadcast(itemMatrix)\r\n\r\n// compute recommendations for each user, and sort them in order of score so that the actual input \r\n// for the APK computation will be correct\r\nval allRecs = model.userFeatures.map{ case (userId, array) => \r\n  val userVector = new DoubleMatrix(array)\r\n  val scores = imBroadcast.value.mmul(userVector)\r\n  val sortedWithId = scores.data.zipWithIndex.sortBy(-_._1)\r\n  val recommendedIds = sortedWithId.map(_._2 + 1).toSeq\r\n  (userId, recommendedIds)\r\n}","dateUpdated":"2016-11-22T10:15:13+0900","config":{"colWidth":12,"editorMode":"ace/mode/scala","graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1479777313149_-1331444756","id":"20161121-105458_1857560573","result":{"code":"SUCCESS","type":"TEXT","msg":"\nimBroadcast: org.apache.spark.broadcast.Broadcast[org.jblas.DoubleMatrix] = Broadcast(57)\n\nallRecs: org.apache.spark.rdd.RDD[(Int, Seq[Int])] = MapPartitionsRDD[239] at map at <console>:47\n"},"dateCreated":"2016-11-22T10:15:13+0900","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:2722"},{"text":"// next get all the movie ids per user, grouped by user id\r\nval userMovies = ratings.map{ case Rating(user, product, rating) => (user, product) }.groupBy(_._1)\r\n// userMovies: org.apache.spark.rdd.RDD[(Int, Seq[(Int, Int)])] = MapPartitionsRDD[277] at groupBy at <console>:21\r\n\r\n// finally, compute the APK for each user, and average them to find MAPK\r\nval K = 10\r\nval MAPK = allRecs.join(userMovies).map{ case (userId, (predicted, actualWithIds)) => \r\n  val actual = actualWithIds.map(_._2).toSeq\r\n  avgPrecisionK(actual, predicted, K)\r\n}.reduce(_ + _) / allRecs.count\r\nprintln(\"Mean Average Precision at K = \" + MAPK)\r\n// Mean Average Precision at K = 0.030486963254725705\r\n\r\n/* Using MLlib built-in metrics */\r\n\r\n// MSE, RMSE and MAE\r\nimport org.apache.spark.mllib.evaluation.RegressionMetrics\r\nval predictedAndTrue = ratingsAndPredictions.map { case ((user, product), (actual, predicted)) => (actual, predicted) }\r\nval regressionMetrics = new RegressionMetrics(predictedAndTrue)\r\nprintln(\"Mean Squared Error = \" + regressionMetrics.meanSquaredError)\r\nprintln(\"Root Mean Squared Error = \" + regressionMetrics.rootMeanSquaredError)\r\n// Mean Squared Error = 0.08231947642632852\r\n// Root Mean Squared Error = 0.2869137090247319\r\n\r\n// MAPK\r\nimport org.apache.spark.mllib.evaluation.RankingMetrics\r\nval predictedAndTrueForRanking = allRecs.join(userMovies).map{ case (userId, (predicted, actualWithIds)) => \r\n  val actual = actualWithIds.map(_._2)\r\n  (predicted.toArray, actual.toArray)\r\n}\r\nval rankingMetrics = new RankingMetrics(predictedAndTrueForRanking)\r\nprintln(\"Mean Average Precision = \" + rankingMetrics.meanAveragePrecision)\r\n// Mean Average Precision = 0.07171412913757183\r\n\r\n// Compare to our implementation, using K = 2000 to approximate the overall MAP\r\nval MAPK2000 = allRecs.join(userMovies).map{ case (userId, (predicted, actualWithIds)) => \r\n  val actual = actualWithIds.map(_._2).toSeq\r\n  avgPrecisionK(actual, predicted, 2000)\r\n}.reduce(_ + _) / allRecs.count\r\nprintln(\"Mean Average Precision = \" + MAPK2000)\r\n// Mean Average Precision = 0.07171412913757186","dateUpdated":"2016-11-22T10:15:13+0900","config":{"colWidth":12,"editorMode":"ace/mode/scala","graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1479777313149_-1331444756","id":"20161121-105512_1080491195","result":{"code":"SUCCESS","type":"TEXT","msg":"\nuserMovies: org.apache.spark.rdd.RDD[(Int, Iterable[(Int, Int)])] = ShuffledRDD[242] at groupBy at <console>:38\n\nK: Int = 10\n\nMAPK: Double = 0.028808513861536114\nMean Average Precision at K = 0.028808513861536114\r\nMean Squared Error = 0.0843760594555458\r\nRoot Mean Squared Error = 0.290475574628136\r\nMean Average Precision = 0.07281562598976575\r\nMean Average Precision = 0.07281562598976576\r\n\r\n\r\n\r\n\r\n\r\n\r\n\nimport org.apache.spark.mllib.evaluation.RegressionMetrics\r\npredictedAndTrue: org.apache.spark.rdd.RDD[(Double, Double)] = MapPartitionsRDD[247] at map at <console>:68\r\nregressionMetrics: org.apache.spark.mllib.evaluation.RegressionMetrics = org.apache.spark.mllib.evaluation.RegressionMetrics@47c592b7\r\nimport org.apache.spark.mllib.evaluation.RankingMetrics\r\npredictedAndTrueForRanking: org.apache.spark.rdd.RDD[(Array[Int], Array[Int])] = MapPartitionsRDD[252] at map at <console>:77\r\nrankingMetrics: org.apache.spark.mllib.evaluation.RankingMetrics[Int] = org.apache.spark.mllib.evaluation.RankingMetrics@7dc7a423\r\nMAPK2000: Double = 0.07281562598976576\n"},"dateCreated":"2016-11-22T10:15:13+0900","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:2723"},{"text":"","dateUpdated":"2016-11-22T10:15:13+0900","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1479777313149_-1331444756","id":"20161122-072527_965619487","dateCreated":"2016-11-22T10:15:13+0900","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:2724"}],"name":"Chapter 04","id":"2C1QBXZQ6","angularObjects":{"2C1F1V6T1:shared_process":[],"2C4NYYN4E:shared_process":[],"2C1PNPERU:shared_process":[],"2C1XC61P9:shared_process":[],"2C14YAFZE:shared_process":[],"2C4MWDWUQ:shared_process":[],"2C2BKQ7E6:shared_process":[],"2C3HUXW9B:shared_process":[],"2C2W2HCXJ:shared_process":[],"2C3W9QEQP:shared_process":[],"2C45CR1HA:shared_process":[],"2C281XB63:shared_process":[],"2BZY8E5ZW:shared_process":[],"2C2SS35W1:shared_process":[],"2C43UG4TU:shared_process":[],"2C1BAWEVT:shared_process":[],"2C26Q58NN:shared_process":[],"2C1Y8BVYX:shared_process":[]},"config":{"looknfeel":"default"},"info":{}}